(function(){
    'use strict';

    electionChartsApp.controller('CoalitionCtrl', ['$scope', '$routeParams', 'coalitionResource', function ($scope, $routeParams, coalitionResource) {
        var coalitionId = $routeParams.coalitionId;

        $scope.coalition = coalitionResource.get(coalitionId);
        var parties = coalitionResource.query(coalitionId, 'result');
        $scope.detailed_results_undeclared = coalitionResource.query(coalitionId, 'detailed_result_undeclared');
        $scope.detailed_results_declared = coalitionResource.query(coalitionId, 'detailed_result_declared');
        $scope.statewise_results = coalitionResource.query(coalitionId, 'statewise_result');
        var results = {"wins":0,"leads":0};

        parties.$promise.then(function(parties){

            results.wins = 0;
            results.leads = 0;
            results.swing = 0;
            results.vote_percentage=0
            for(var p in parties){
                if(parties[p].wins){
                    results.wins = results.wins+ parties[p].wins;
                }
                if(parties[p].leads){
                    results.leads = results.leads+ parties[p].leads;
                }
                if(parties[p].swing){
                    results.swing = results.swing+ parties[p].swing;
                }
                if(parties[p].vote_percentage){
                    results.vote_percentage = results.vote_percentage +parseFloat(parties[p].vote_percentage);
                }
//                results.vote_percentage = results.vote_percentage+ p.vote_percentage;
            }
            results.vote_percentage = Number(results.vote_percentage.toFixed(2));
            $scope.results = results;
            $scope.parties = parties;
        });

    }]);
}());
